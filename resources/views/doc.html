<!DOCTYPE html>
<html lang="en">
    <head>
        <title>{{ docTitle }} | Aphiria</title>
        {{ head }}
        <style>
            .context-framework, .context-library {
                display: none;
            }
        </style>
        <script>
            function setCookie(name, value, days) {
                const date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                document.cookie = `${name}=${value};expires=${date.toUTCString()};path=/;domain=.aphiria.com;Secure;SameSite=Lax`;
            }

            function getCookie(name) {
                const cookies = document.cookie.split(';');

                for (const cookie of cookies) {
                    const [key, value] = cookie.trim().split('=');
                    if (key === name) return value;
                }

                return null;
            }

            function toggleContext(view) {
                const frameworkDivs = document.querySelectorAll('.context-framework');
                const libraryDivs = document.querySelectorAll('.context-library');
                const docSideNav = document.querySelector('nav.side-nav');
                const tocContents = document.querySelector('.toc-nav-contents');
                const footer = document.querySelector('body > footer');

                if (view === 'framework') {
                    frameworkDivs.forEach(div => div.style.display = 'revert');
                    libraryDivs.forEach(div => div.style.display = 'none');
                } else if (view === 'library') {
                    frameworkDivs.forEach(div => div.style.display = 'none');
                    libraryDivs.forEach(div => div.style.display = 'revert');
                }

                // Changing visibility of elements requires re-sticking the side nav as it may have changed its height
                makeSideNavStick(docSideNav, tocContents, footer)
            }

            document.addEventListener('DOMContentLoaded', () => {
                const contextSelector = document.getElementById('context-selector');
                const savedContext = getCookie('context') || 'framework';

                contextSelector.value = savedContext;
                toggleContext(savedContext);

                // Add event listener to update the view and cookie on selection
                contextSelector.addEventListener('change', (event) => {
                    const selectedContext = event.target.value;
                    setCookie('context', selectedContext, 365);
                    toggleContext(selectedContext);
                });
            });
        </script>
    </head>
    <body class="docs language-php loading">
        <header>
            {{ mainNav }}
        </header>
        <main>
            {{ sideNav }}
            <article>
                <div id="article-loading"></div>
                {{ doc }}
                <footer>
                    <a href="https://github.com/aphiria/docs/blob/{{ docVersion }}/{{ docFilename }}.md" target="_blank" title="Edit this document"><span class="edit-icon">&#9998;</span> Edit this document</a>
                </footer>
            </article>
            <div id="gray-out"></div>
        </main>
        <footer>
            {{ footer }}
        </footer>
    </body>
</html>
